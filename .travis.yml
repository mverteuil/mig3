dist: xenial
language: python
sudo: false
services:
  - postgresql
env:
  - "DATABASE_URL=postgres://postgres:postgres@localhost:5432/postgres"
python:
  - "3.7"
install:
  - "pip install pip==19.1.1 poetry==0.12.17"
  - "poetry install --no-dev"
  - "curl -H 'Cache-Control: no-cache' https://raw.githubusercontent.com/fossas/fossa-cli/master/install.sh | sudo bash"
  - "fossa analyze || true"
  - "poetry install"
before_script:
  - "barb -z"
script:
  - "python -m pytest"
after_success:
  - "pip install codacy-coverage==1.3.11"
  - "coverage xml"
  - "python-codacy-coverage -r coverage.xml"
